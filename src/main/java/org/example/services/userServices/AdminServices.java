package org.example.services.userServices;

import org.example.controller.Colors;
import org.example.model.Question;
import org.example.model.Toy;
import org.example.services.DataServices;

import java.util.List;
import java.util.Scanner;

/**
 ?????, ???????????? ??????? ?? ?????????? ??????????????
*/
public class AdminServices {

    /**
       ????????? ? ?????????? ?????? ?? ??????? ? ????
    */
    public void addToy() {
        Scanner scanner = new Scanner(System.in);

        int id = getPrizesList().size() + 1;

        System.out.println(Colors.BLUE + "??????? ???????? ???????: " + Colors.RESET);
        String title = scanner.nextLine();

        String amount;
        do {
            System.out.println(Colors.BLUE + "??????? ?????????? ???????: " + Colors.RESET);
            amount = scanner.nextLine();
        } while (!amount.matches("\\d+"));

        String priority;
        do {
            System.out.println(Colors.BLUE + "??????? ???? ????????? ??????? ?? 1 ?? 9: " + Colors.RESET);
            priority = scanner.nextLine();
        } while (!priority.matches("[1-9]"));

        DataServices.writeData(new Toy(id, title, Integer.parseInt(amount), Integer.parseInt(priority)), true);
    }

    /**
     * ????????? ?????? ? ???? ???????? ? ???? ??????
     * @return ?????? ???????
     */
    public List<Toy> getPrizesList() {
        return DataServices.readData();
    }

    /**
     * ???????? ?????? ??????????????
     * @param password ?????? ???????
     * @return true ???? ???? ??????????, false ???? ???
     */
    public boolean checkPassword(String password) {
        return password.matches("123456");
    }

    /**
     * ????????? ? ?????????? ?????? ? ???????? ? ????????? ? ????
     */
    public void addQuestion() {
        Scanner scanner = new Scanner(System.in);

        int id = DataServices.getQuestions().size() + 1;

        System.out.println(Colors.YELLOW + "??????? ????? ???????: " + Colors.RESET);
        String text = scanner.nextLine();
        Question question = new Question(id, text, 0);

        do {
            System.out.println(Colors.YELLOW + "???????? ??????? ??????: " + Colors.RESET);
            String variant = scanner.nextLine();
            question.getListAnswer().add(variant);
        } while (!retryEnter("???????"));

        do {
            System.out.println(Colors.GREEN + "??????? ?????, ??????????? ???????? ??????." + Colors.RESET);
            text = scanner.nextLine();
        }
        while (!text.matches("[0-9]"));

        question.setTrueAnswer(Integer.parseInt(text));

        DataServices.writeQuestion(question);
    }

    /**
     * ???????? ?????? ???????? ?????????
     */
    public void getQuestionList() {
        List<Question> list = DataServices.getQuestions();
        System.out.println(Colors.BLUE + "====================================================" + Colors.RESET);
        System.out.println(Colors.BLUE + "=========== ?????? ???????? ????????? ==============" + Colors.RESET);
        System.out.println(Colors.BLUE + "====================================================" + Colors.RESET);
        for (Question question : list) {
            System.out.printf(Colors.BLUE + "??????: %s\n????? ??????????? ??????: \"%d\"\n", question.getBody(), question.getTrueAnswer(), Colors.RESET);
            System.out.println(Colors.BLUE + "__________________________________________________________________________" + Colors.RESET);
        }
    }

    /**
     * ???????? ?????????? ????? ????????? ???????
     * @param str ???????
     * @return true ???? 0, false ???? 1
     */
    private boolean retryEnter(String str) {
        Scanner scanner = new Scanner(System.in);
        System.out.printf(Colors.BLUE + "???????? ??? ???? %s? ??????? 1, ??? ?????? ??????? 0\n:>>> ", str, Colors.RESET);
        int variant;
        do {
            System.out.print(": ");
            while (!scanner.hasNextInt()) {
                System.out.println(Colors.RED + "??????? ?????? 1 ??? 0!" + Colors.RESET);
                scanner.next();
            }
            variant = scanner.nextInt();
            switch (variant) {
                case 1 -> {
                    return false;
                }
                case 0 -> {
                    return true;
                }
            }
        } while (variant > 1 || variant < 0);
       return true;
    }
}



